<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>background</title>
    <link rel="stylesheet" href="./../../assets/css/refer.css" />
  </head>
  <body>
    <div class="wrap">
      <aside class="visual-background"></aside>
      <main class="container main">
        <section class="visual-area" data-page>
          <div class="visual-section">
            <aside class="v-prev">
              <button class="btn-link" data-link="company">
                <em class="menu">COMPANY</em>
                <span class="animate-arrow"></span>
              </button>
            </aside>
            <!-- plant rotate -->
            <div class="v-crnt">
              <article class="v-carousel">
                <ul class="v-carousel-container">
                  <li class="c-item main is-active">
                    <div class="c-item-container">
                      <div class="img-plant"></div>
                      <div class="v-info">
                        <hgroup class="title-group">
                          <h5 class="t-summary">INTRO</h5>
                          <h3 class="t-title">Anyone can be a STAR</h3>
                        </hgroup>
                        <p class="v-info-text">
                          <strong
                            >우리는 누구나 별이 될 수 있도록 돕는 <br />AI 기술
                            기반의 스타트업</strong
                          >
                          입니다.<br />자사만의 Thinking AI는 다양한 분야에서
                          적용되어
                          <br />
                          꿈꾸는 별이 될 수 있도록 돕고 있습니다.
                        </p>
                      </div>
                    </div>
                  </li>
                  <li class="c-item about">
                    <div class="c-item-container">
                      <div class="img-plant"></div>
                      <div class="v-info">
                        <hgroup class="title-group">
                          <h5 class="t-summary">ABOUT ASTAR</h5>
                          <h3 class="t-title">The brightest star, ASTAR</h3>
                        </hgroup>
                        <p class="v-info-text">
                          아스타는 자사의 미션처럼 <br />
                          누구나 꿈꿀 수 있는 별이 될 수 있도록 <br />
                          <strong>
                            다양한 사업 영역으로 확장하면서 뜻깊은 <br />
                            시간들을 보내고 있습니다.
                          </strong>
                        </p>
                      </div>
                    </div>
                  </li>
                  <li class="c-item business">
                    <div class="c-item-container">
                      <div class="img-plant"></div>
                      <div class="v-info">
                        <hgroup class="title-group">
                          <h5 class="t-summary">BUSINESS</h5>
                          <h3 class="t-title">
                            The Big Bang <br />in the Age of AI
                          </h3>
                        </hgroup>
                        <p class="v-info-text">
                          감성 AI 엔진부터 Generative AI 까지 인공 지능에 <br />
                          최적화된 분야로 독자적인 엔지니어랑과 기술력을 통해<br />
                          서비스를 개발 및 운영하고 있습니다.
                        </p>
                      </div>
                    </div>
                  </li>
                  <li class="c-item company">
                    <div class="c-item-container">
                      <div class="img-plant"></div>
                      <div class="v-info">
                        <hgroup class="title-group">
                          <h5 class="t-summary">Company</h5>
                          <h3 class="t-title">ASTAR's Goals</h3>
                        </hgroup>
                        <p class="v-info-text">
                          감성 AI 엔진부터 Generative AI 까지 인공 지능에 <br />
                          최적화된 분야로 독자적인 엔지니어랑과 기술력을 통해<br />
                          서비스를 개발 및 운영하고 있습니다.
                        </p>
                      </div>
                    </div>
                  </li>
                </ul>
              </article>
              <div class="v-desc">
                <p class="txt">아스타 은하계로 함께 떠나볼까요?</p>
                <span class="animate-scroll-down"></span>
              </div>
              <div class="m-desc">
                <ul class="p-container"></ul>
                <div class="desc-text">
                  <p class="txt">READ MORE</p>
                  <span class="animate-scroll-down"></span>
                </div>
              </div>
            </div>
            <!-- plant rotate -->
            <aside class="v-next">
              <button class="btn-link" data-link="about">
                <em class="menu">ABOUT ASTAR</em>
                <span class="animate-arrow"></span>
              </button>
            </aside>
          </div>
        </section>
      </main>
    </div>

    <script src="./../../assets/js/lib/three.min.js"></script>
    <script type="module" src="./../../assets/js/main.js"></script>
    <script>
      const _carousel = document.querySelector(".v-carousel-container");
      const _dom = {
        items: Array.from(document.querySelectorAll(".c-item")).map((x) => x),
        container: Array.from(
          document.querySelectorAll(".c-item-container")
        ).map((x) => x),
        info: document.querySelectorAll(".v-info"),
      };
      let infoWidth = 0;
      const names = ["INTRO", "ABOUT ASTAR", "BUSINESS", "COMPANY"];
      const _prev = document.querySelector(".v-prev");
      const _next = document.querySelector(".v-next");
      let currdeg = 0;
      let index = 0;

      init();

      function rotateLayout() {
        return new Promise((resolve) => {
          setTimeout(() => {
            // layout rotate
            _carousel.style = `transform: rotateY(${currdeg}deg)`;
            _dom.container.forEach((el, idx) => {
              let style = `transform: rotateY(${-currdeg}deg); `;
              if (idx === index) {
                el.parentElement.classList.add("is-active");
              } else {
                if (idx == calcIdx(0, index + 2)) style += "opacity: 0;";
                el.parentElement.classList.remove("is-active");
              }
              el.style = style;
            });
            resolve();
          }, 300);
        });
      }

      function setBeforeRotate() {
        return new Promise((resolve) => {
          _dom.info.forEach((info, idx) => {
            if (idx === index) return;
            info.style.opacity = 0;
            if (info.clientWidth) {
              animate({
                delay: 300,
                duration: 500,
                draw(progress) {
                  widthZero(info, progress, infoWidth);
                },
              }).then(resolve);
            }
          });
        });
      }
      function setAfterRotate() {
        const info = _dom.info[index];
        return new Promise((resolve) => {
          animate({
            duration: 500,
            draw(progress) {
              widthFull(info, progress, infoWidth);
            },
          }).then(() => {
            info.style.opacity = 1;
            resolve();
          });
        });
      }

      function rotate() {
        _carousel.classList.add("is-animate");
        setBeforeRotate()
          .then(rotateLayout)
          .then(setAfterRotate)
          .then(() => {
            _prev.querySelector(".menu").innerHTML = names[calcIdx(-1)];
            _next.querySelector(".menu").innerHTML = names[calcIdx(1)];
            _carousel.classList.remove("is-animate");
          });
      }

      function widthZero(el, percent, width) {
        const _w = width - width * percent;
        el.style.width = `${_w}px`;
      }
      function widthFull(el, percent, width) {
        const _w = width * percent;
        el.style.width = `${_w}px`;
      }
      function calcIdx(arrow = 0, idx = index) {
        let i = (idx + arrow) % _dom.container.length;
        return i < 0 ? 3 : i;
      }

      function animate({ delay = 0, draw, duration }) {
        return new Promise(function (resolve) {
          setTimeout(() => {
            let start = performance.now();
            requestAnimationFrame(function animate(time) {
              let timeFraction = (time - start) / duration;
              if (timeFraction > 1) timeFraction = 1;

              draw(timeFraction); // draw it

              if (timeFraction < 1) {
                requestAnimationFrame(animate);
              } else {
                resolve(true);
              }
            });
          }, delay);
        });
      }

      function init() {
        if (window.innerWidth > 1180) {
          infoWidth = _dom.info[0].getBoundingClientRect().width;
        } else {
          infoWidth = window.innerWidth;
        }
        rotate();

        _next.addEventListener("click", () => {
          index = calcIdx(1);
          currdeg = currdeg - 90;
          rotate();
        });
        _prev.addEventListener("click", () => {
          index = calcIdx(-1);
          currdeg = currdeg + 90;
          rotate();
        });
      }
    </script>
  </body>
</html>
